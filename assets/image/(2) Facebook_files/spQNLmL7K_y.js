if (self.CavalryLogger) { CavalryLogger.start_js(["xM4m3UO"]); }

__d("LSAddDeviceFromVirtualDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAtV2","LSBase64Decode.bs","LSBase64Encode.bs","LSCreateAuthKeyPair.bs","LSCreateDerivedKeys.bs","LSCreateEncryptionKeyPair.bs","LSCreateSignatureKeyPair.bs","LSCreateSignature_v2.bs","LSDeleteBackupOnClient","LSGetBlobFromString.bs","LSHandleWrongRecoveryCode","LSHmac_v2.bs","LSIssueNewTask","LSOcmfClientEvolve_v2.bs","LSSymmetricEncryptionCreateDecryptedString.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]Beginning execution."),c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}).next().then(function(e,g){g=e.done;e=e.value;return g?c.seq([function(a){return d[3]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[3]||a.g===d[3]||a.h===d[3]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[4]=f:(b=a.item,d[4]=b.a)})},function(a){return d[1]=d[4]}])},function(a){return d[1]!==f?c.sp(b("LSAppendDataTraceAddon"),d[1],[0,1414],[0,2],f,f):c.resolve()},function(e){return c.db.table(179).fetch([[[a[0]]]]).next().then(function(e,g){var h=e.done;e=e.value;return h?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]Request context for the passed task_id was not found"):(g=e.item,c.seq([function(a){return d[6]=g.c,c.db.table(168).fetch().next().then(function(d,e){var a=d.done;d=d.value;return a?0:(e=d.item,c.sp(b("LSDeleteBackupOnClient"),e.a))})},function(e){return c.db.table(185).fetch([[[[0,1]]]]).next().then(function(i,j){var e=i.done;i=i.value;return e?c.db.table(168).fetch().next().then(function(d,e){var a=d.done;d=d.value;return a?0:(e=d.item,c.sp(b("LSDeleteBackupOnClient"),e.a))}):(j=i.item,c.seq([function(e){return d[7]=a[3].get("encrypted_ocmf_client_state"),a[3],c.nop(b("LSSymmetricEncryptionCreateDecryptedString.bs"),d[6],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[7]).then(function(a){return a=a,d[8]=a[0],a})},function(a){return c.nop(b("LSBase64Decode.bs"),d[8]).then(function(a){return a=a,d[9]=a[0],a})},function(e){return d[10]=a[3].get("encrypted_oblivious_validation_token_blob"),a[3],c.nop(b("LSSymmetricEncryptionCreateDecryptedString.bs"),d[6],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nop(b("LSBase64Decode.bs"),d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(e){return d[13]=a[3].get("encrypted_epoch_anon_id"),a[3],c.nop(b("LSSymmetricEncryptionCreateDecryptedString.bs"),d[6],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[13]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return c.nop(b("LSBase64Decode.bs"),d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(e){return d[16]=a[3].get("encrypted_epoch_root_key"),a[3],c.nop(b("LSSymmetricEncryptionCreateDecryptedString.bs"),d[6],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.nop(b("LSBase64Decode.bs"),d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(e){return d[19]=a[3].get("encrypted_mailbox_root_key_blob"),a[3],c.nop(b("LSSymmetricEncryptionCreateDecryptedString.bs"),d[6],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.nop(b("LSBase64Decode.bs"),d[20]).then(function(a){return a=a,d[21]=a[0],a})},function(e){return d[22]=a[3].get("encrypted_epoch_storage_private_key"),a[3],d[22]!==f?c.seq([function(a){return c.nop(b("LSSymmetricEncryptionCreateDecryptedString.bs"),d[6],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[22]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.nop(b("LSBase64Decode.bs"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[23]=d[33]}]):c.resolve(d[23]=f)},function(a){return c.nop(b("LSCreateSignatureKeyPair.bs")).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return c.nop(b("LSCreateEncryptionKeyPair.bs")).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[24],c.blob("MA=="),d[27]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.nop(b("LSCreateAuthKeyPair.bs")).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[24],c.blob("MQ=="),d[30]).then(function(a){return a=a,d[31]=a[0],a})},function(e){return c.blobs.neq(d[9],f)?c.seq([function(a){return c.nop(b("LSOcmfClientEvolve_v2.bs"),d[9]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(e){return c.blobs.neq(d[15],f)?c.blobs.neq(d[18],f)?c.blobs.neq(d[12],f)?c.blobs.neq(d[21],f)?c.seq([function(a){return d[34]=c.createArray(),d[34].push([0,0]),d[34],d[34].push([0,2]),d[34],d[35]="",d[36]=c.i64.of_int32(d[34].length),c.i64.gt(d[36],[0,0])?c.loopAsync(d[36],function(a){return d[46]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[34],d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[35]=[d[35],"_",c.i64.to_string(d[47])].join("")}])}):c.resolve()},function(a){return c.nop(b("LSGetBlobFromString.bs"),["supported_versions_",d[35],"revision_version_",c.i64.to_string([0,1])].join("")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[24],c.blob("Mg=="),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.blobs.neq(d[38],f)?c.seq([function(a){return c.nop(b("LSBase64Encode.bs"),d[38]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[39]=d[46]}]):c.resolve(d[39]=f)},function(b){return d[40]=c.createArray(),c.fe(c.ftr(c.db.table(191).fetch(),function(b){return c.i64.eq(a[1],b.a)}),function(a){var b=a.item;return c.seq([function(a){return d[46]=c.createArray(),c.fe(c.db.table(192).fetch([[[b.b]]]),function(a){a=a.item;return d[46].push(a.b),d[46]})},function(a){return d[47]=c.i64.of_int32(d[46].length),c.i64.gt(d[47],[0,0])?(d[40].push(d[46]),d[40]):0}])})},function(a){return d[41]=c.createArray(),d[41].push([0,0]),d[41],d[41].push([0,2]),d[41],d[42]=c.createArray(),d[43]=c.i64.of_int32(d[41].length),c.i64.gt(d[43],[0,0])?c.loopAsync(d[43],function(a){return d[46]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[41],d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[42].push(d[47]),d[42]}])}):c.resolve()},function(b){return d[40].push(d[42]),d[40],function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsVersioningUtils]LSEncryptedBackupsVersioningGetEncryptionVersionFromSupportedVersionsList native op not supported"),c.fe(c.ftr(c.db.table(168).fetch([[[a[1]]]]),function(b){return c.i64.eq(b.a,a[1])&&c.i64.lt(b.i,[0,20])}),function(a){return a["delete"]()})},function(b){return c.db.table(168).add({a:a[1],b:d[25],c:d[24],d:d[27],e:d[26],l:d[30],k:d[29],f:d[21],g:d[32],h:d[12],n:[0,0],o:[0,1],i:[0,20],m:[0,1]})},function(b){return c.fe(c.ftr(c.db.table(169).fetch([[[a[2]]]]),function(b){return c.i64.eq(b.a,a[2])&&c.i64.lt(b.f,[0,80])}),function(a){return a["delete"]()})},function(b){return c.db.table(169).add({a:a[2],f:[0,80],b:a[1],c:d[15],d:d[18],e:[0,1]})},function(b){return c.db.table(169).fetch([[[a[2]]]]).next().then(function(e,g){var b=e.done;e=e.value;return b?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]No epochs keys found."),d[44]=f):(g=e.item,d[46]=new c.Map(),d[46].set("epoch_root_key",g.d),d[46].set("epoch_anon_id",g.c),d[46].set("epoch_id",a[2]),d[44]=d[46])})},function(e){return d[44]!==f?c.seq([function(a){return d[46]=d[44].get("epoch_anon_id"),d[44],d[47]=d[44].get("epoch_root_key"),d[44],d[48]=c.createArray(),d[48].push([0,32]),d[48],c.nop(b("LSBase64Encode.bs"),d[46]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_devices","_",d[49]].join("")),f,d[47],d[48]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[52],[0,0]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[50]=d[53]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[50]=d[52]}])},function(a){return c.nop(b("LSHmac_v2.bs"),d[50],d[25]).then(function(a){return a=a,d[51]=a[0],a})},function(e){return c.blobs.neq(d[51],f)?c.seq([function(a){return d[52]=d[44].get("epoch_id"),d[44],c.nop(b("LSBase64Encode.bs"),d[25]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[51]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[27]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[28]==null?c.blob("bnVsbA=="):d[28]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[30]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[31]==null?c.blob("bnVsbA=="):d[31]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[33]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),g.b).then(function(a){return a=a,d[60]=a[0],a})},function(e){return d[61]=new c.Map(),d[61].set("supported_encryption_versions",d[34]),d[61].set("client_version",[0,1]),d[61].set("version_sig",d[39]==null?"":d[39]),d[62]=new c.Map(),d[62].set("backup_id",a[1]),d[62].set("device_epoch_hmac",d[54]==null?"":d[54]),d[62].set("device_public_key",d[53]==null?"":d[53]),d[62].set("epoch_storage_pubkey",d[55]==null?"":d[55]),d[62].set("epoch_storage_pubkey_sig",d[56]==null?"":d[56]),d[62].set("epoch_auth_pubkey",d[57]==null?"":d[57]),d[62].set("epoch_auth_pubkey_sig",d[58]==null?"":d[58]),d[62].set("ocmf_rotation_token",d[59]==null?"":d[59]),d[62].set("virtual_device_id",d[60]==null?"":d[60]),d[62].set("device_registration_id",j.d),d[62].set("base_epoch_id",d[52]),d[62].set("encryption_version_data",d[61]),d[63]=c.toJSON(d[62]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50006],d[63],f,f,[0,0],f)},function(a){return c.db.table(178).put({a:[0,1],b:[0,2]})}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]$device_epoch_hmac found to be null"))}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]$latest_epoch_data is null."))}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]$mailbox_root_key found to be null"),c.sp(b("LSHandleWrongRecoveryCode"))):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]$oblivious_validation_token found to be null"),c.sp(b("LSHandleWrongRecoveryCode"))):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]$epoch_root_key found to be null"),c.sp(b("LSHandleWrongRecoveryCode"))):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]$epoch_anon_id found to be null"),c.sp(b("LSHandleWrongRecoveryCode")))}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]$ocmf_client_state_virtual found to be null"),c.sp(b("LSHandleWrongRecoveryCode")))}]))})}]))})}]):(e.item,function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]An authoritative row already exists, aborting execution of addDeviceFromVirtualDevice"))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceFromVirtualDeviceStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSGetFirstAvailableAdminMessageCTAID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return b.seq([function(a){return b.seq([function(a){return b.db.table(27).fetchDesc([[[]],"ctaId"]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=[0,1]:(d=a.item,c[0]=b.i64.add(d.c,[0,1]))})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSApplyAdminMessageCTA",["LSGetFirstAvailableAdminMessageCTAID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[];return c.seq([function(e){return c.seq([function(a){return c.sp(b("LSGetFirstAvailableAdminMessageCTAID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(27).put({a:a[0],b:a[2],c:d[0],d:a[1],e:a[5],f:a[6],g:a[7],h:a[8],i:a[3],j:a[9],k:a[10],l:a[11],m:a[12]})},function(b){return c.fe(c.ftr(c.db.table(12).fetch([[[a[0],a[1],a[2]]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.eq([0,0],[0,0])&&c.i64.eq(b.b,a[1])&&b.e===a[2]}),function(b){var c=b.update;b.item;return c({K:d[0],L:a[3],M:a[4]})})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSCreateBackupMailbox",["LSAppendDataTraceAddon","LSBase64Encode.bs","LSGetBlobFromString.bs","LSHmac_v2.bs","LSIssueNewTask","LSOcmfClientMap.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsCreateBackupMailboxStoredProcedure]Beginning execution."),d[2]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[2]||a.g===d[2]||a.h===d[2]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[3]=f:(b=a.item,d[3]=b.a)})},function(a){return d[0]=d[3]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1403],[0,2],f,f):c.resolve()},function(e){return c.db.table(168).fetch([[[a[0]]]]).next().then(function(e,g){var h=e.done;e=e.value;return h?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateBackupMailboxStoredProcedure]Row not found in client state table."):(g=e.item,c.seq([function(e){return d[7]=g.j,c.nop(b("LSGetBlobFromString.bs"),c.i64.to_string(a[0])).then(function(a){return a=a,d[3]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.bs"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.bs"),g.g,d[4]).then(function(a){return a=a,d[5]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(e){return c.i64.neq(d[7],f)?(d[8]=new c.Map(),d[8].set("mailbox_partial_id",d[6]==null?"":d[6]),d[8].set("device_id",d[7]),d[9]=c.toJSON(d[8]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50002],d[9],f,f,[0,0],f)):c.seq([function(b){return c.fe(c.db.table(168).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateBackupMailboxStoredProcedure]device_id is null")}])}]))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsCreateBackupMailboxStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSCreateVirtualDevice",["LSArrayGetObjectAtV2","LSBase64Encode.bs","LSCreateDerivedKeys.bs","LSCreateEncryptionKeyPair.bs","LSCreateSignatureKeyPair.bs","LSCreateSignature_v2.bs","LSDeleteBackupOnClient","LSDeleteBackups","LSGetBlobFromString.bs","LSGetViewerFBID","LSHmac_v2.bs","LSIssueNewTask","LSOcmfClientEvolve_v2.bs","LSParseRecoveryCode_v2.bs","LSSymmetricEncryptionCreateEncryptedString.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceStoredProcedure]Beginning execution."),d[0]=c.createArray(),c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[1]=a[0],a})},function(e){return c.nop(b("LSParseRecoveryCode_v2.bs"),a[1],c.i64.to_string(d[1])).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return c.blobs.neq(d[3],f)?c.blobs.neq(d[2],f)?c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Beginning execution."),c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.e,[0,1])&&c.i64.eq(a.f,[0,80])}).next().then(function(a,e){var g=a.done;a=a.value;return g?c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Beginning execution."),c.ftr(c.db.table(2).fetch(),function(a){return a.d===c.i64.to_string([0,50013])}).next().then(function(a,b){b=a.done;a=a.value;return b?d[7]=!1:(a.item,d[7]=!0)})},function(a){return d[7]?c.resolve(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Another sync job is already in progress. Terminating this.")):c.seq([function(a){return c.ct(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])})).then(function(a){return d[9]=a})},function(a){return c.i64.eq(d[9],[0,1])?c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}).next().then(function(e,h){var a=e.done;e=e.value;return a?0:(h=e.item,d[11]=h.a,d[10]=h.j,c.i64.neq(d[10],f)?(d[12]=new c.Map(),d[12].set("backup_id",d[11]),d[12].set("device_id",d[10]),d[13]=c.toJSON(d[12]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50013],d[13],f,f,[0,0],f)):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]device_id is null. Cleaning backup on client"),c.sp(b("LSDeleteBackupOnClient"),d[11])))}):c.seq([function(a){return c.ct(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])})).then(function(a){return d[10]=a})},function(a){return d[11]="",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]",d[11],"Exactly 1 entry is expected in client_state_table. Found = ",d[11],c.i64.to_string(d[10])].join(""))}])}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Finishing execution.")}])},function(a){return d[5]=f}]):(e=a.item,d[7]=new c.Map(),d[7].set("epoch_id",e.a),d[7].set("epoch_root_key",e.d),d[7].set("epoch_anon_id",e.c),d[5]=d[7])})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Finishing execution."),d[4]=d[5]}])},function(e){return d[4]!==f?c.seq([function(a){return c.seq([function(a){return c.ct(c.db.table(169).fetch()).then(function(a){return d[56]=a})},function(a){return c.i64.gt(d[56],[0,1])?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Multiple rows in $epoch_tables."):0}])},function(a){return c.nop(b("LSCreateSignatureKeyPair.bs")).then(function(a){return a=a,d[5]=a[0],d[6]=a[1],a})},function(a){return c.nop(b("LSCreateEncryptionKeyPair.bs")).then(function(a){return a=a,d[7]=a[0],d[8]=a[1],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[5],c.blob("MA=="),d[8]).then(function(a){return a=a,d[9]=a[0],a})},function(b){return d[54]=c.blob(""),d[55]=c.blob(""),c.db.table(168).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Row with backupid not found in client state table"),e=[d[54],d[55],f,c.blob("")],d[10]=e[0],d[11]=e[1],d[12]=e[2],d[13]=e[3],e):(b=a.item,e=[b.h,b.f,b.j,b.g],d[10]=e[0],d[11]=e[1],d[12]=e[2],d[13]=e[3],e)})},function(a){return c.blobs.eq(d[10],d[54])?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]oblivious_token is empty!"):0,c.blobs.eq(d[11],d[55])?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]mailbox_root_key is empty!"):0,d[15]=d[4].get("epoch_anon_id"),d[4],d[16]=d[4].get("epoch_root_key"),d[4],d[17]=c.createArray(),d[17].push([0,32]),d[17],c.nop(b("LSBase64Encode.bs"),d[15]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_devices","_",d[18]].join("")),f,d[16],d[17]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[56],[0,0]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[19]=d[57]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[19]=d[56]}])},function(a){return c.nop(b("LSHmac_v2.bs"),d[19],d[6]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.blobs.neq(d[20],f)?c.resolve(d[21]=d[20]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]device_epoch_hmac is null!"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[21]=d[56]}])},function(a){return c.nop(b("LSOcmfClientEvolve_v2.bs"),d[13]).then(function(a){return a=a,d[22]=a[0],d[23]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[5]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[3],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[25]!==f?d[26]=d[25]:d[26]="",d[26]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_device_private_key is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[7]).then(function(a){return a=a,d[27]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[3],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[27]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]!==f?d[29]=d[28]:d[29]="",d[29]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_epoch_storage_private_key is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[22]).then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[3],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[30]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]!==f?d[32]=d[31]:d[32]="",d[32]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_ocmf_client_state_crypto is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[10]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[3],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[33]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]!==f?d[35]=d[34]:d[35]="",d[35]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_oblivious_validation_token is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[11]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[3],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]!==f?d[38]=d[37]:d[38]="",d[38]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_mailbox_root_key is empty!"):0,d[39]=d[4].get("epoch_anon_id"),d[4],c.nop(b("LSBase64Encode.bs"),d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[3],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]!==f?d[42]=d[41]:d[42]="",d[42]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_epoch_anon_id is empty!"):0,d[43]=d[4].get("epoch_root_key"),d[4],c.nop(b("LSBase64Encode.bs"),d[43]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[3],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]!==f?d[46]=d[45]:d[46]="",d[46]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_epoch_root_key is empty!"):0,d[47]=new c.Map(),d[47].set("encrypted_device_private_key",d[26]),d[47].set("encrypted_epoch_storage_private_key",d[29]),d[47].set("encrypted_ocmf_client_state",d[32]),d[47].set("encrypted_oblivious_validation_token_blob",d[35]),d[47].set("encrypted_mailbox_root_key_blob",d[38]),d[47].set("encrypted_epoch_anon_id",d[42]),d[47].set("encrypted_epoch_root_key",d[46]),c.nop(b("LSBase64Encode.bs"),d[2]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[6]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[8]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[9]==null?c.blob("bnVsbA=="):d[9]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[21]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[23]).then(function(a){return a=a,d[53]=a[0],a})},function(e){return c.i64.neq(d[12],f)?(d[56]=d[4].get("epoch_id"),d[4],d[57]=new c.Map(),d[57].set("backup_id",a[0]),d[57].set("request_device_id",d[12]),d[57].set("virtual_device_id",d[48]==null?"":d[48]),d[57].set("encrypted_secret_values",d[47]),d[57].set("public_key",d[49]==null?"":d[49]),d[57].set("epoch_storage_pubkey",d[50]==null?"":d[50]),d[57].set("epoch_storage_pubkey_sig",d[51]==null?"":d[51]),d[57].set("device_epoch_hmac",d[52]==null?"":d[52]),d[57].set("ocmf_rotation_token",d[53]==null?"":d[53]),d[57].set("is_init",!1),d[57].set("epoch_id",d[56]),d[58]=c.toJSON(d[57]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50004],d[58],f,f,[0,0],f)):c.seq([function(b){return c.fe(c.db.table(168).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Device id is null")}])}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Epoch keys are unavailable."),c.resolve())}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Invalid Recovery Code Provided"),c.resolve()):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Invalid Recovery Code Provided"),c.resolve())},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSCreateVirtualDeviceV2",["LSAppendDataTraceAddon","LSArrayGetObjectAtV2","LSBase64Encode.bs","LSCreateDerivedKeys.bs","LSCreateEncryptionKeyPair.bs","LSCreateSignatureKeyPair.bs","LSCreateSignature_v2.bs","LSDeleteBackupOnClient","LSDeleteBackups","LSGetBlobFromString.bs","LSGetViewerFBID","LSHmac_v2.bs","LSIssueNewTask","LSOcmfClientEvolve_v2.bs","LSParseRecoveryCode_v2.bs","LSSymmetricEncryptionCreateEncryptedString.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Beginning execution."),d[4]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[4]||a.g===d[4]||a.h===d[4]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[5]=f:(b=a.item,d[5]=b.a)})},function(a){return d[0]=d[5]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1410],[0,2],f,f):c.resolve()},function(b){return c.ftr(c.db.table(168).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.eq(b.i,[0,20])}).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(e){return c.db.table(174).fetch([[[[0,1]]]]).next().then(function(e,g){var h=e.done;e=e.value;return h?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Recovery code not created, will not create virtual device"),d[1]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Deleting backup due to error"),c.sp(b("LSDeleteBackups"),a[0])):c.resolve()):(g=e.item,c.seq([function(a){return d[5]=c.createArray(),c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[6]=a[0],a})},function(a){return c.nop(b("LSParseRecoveryCode_v2.bs"),g.b,c.i64.to_string(d[6])).then(function(a){return a=a,d[7]=a[0],d[8]=a[1],a})},function(e){return c.blobs.neq(d[8],f)?c.blobs.neq(d[7],f)?c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Beginning execution."),c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.e,[0,1])&&(d[1]||c.i64.eq(a.f,[0,80]))}).next().then(function(e,g){var a=e.done;e=e.value;return a?c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Beginning execution."),c.ftr(c.db.table(2).fetch(),function(a){return a.d===c.i64.to_string([0,50013])}).next().then(function(a,b){b=a.done;a=a.value;return b?d[12]=!1:(a.item,d[12]=!0)})},function(a){return d[12]?c.resolve(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Another sync job is already in progress. Terminating this.")):c.seq([function(a){return c.ct(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])})).then(function(a){return d[14]=a})},function(a){return c.i64.eq(d[14],[0,1])?c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}).next().then(function(e,g){var a=e.done;e=e.value;return a?0:(g=e.item,d[16]=g.a,d[15]=g.j,c.i64.neq(d[15],f)?(d[17]=new c.Map(),d[17].set("backup_id",d[16]),d[17].set("device_id",d[15]),d[18]=c.toJSON(d[17]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50013],d[18],f,f,[0,0],f)):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]device_id is null. Cleaning backup on client"),c.sp(b("LSDeleteBackupOnClient"),d[16])))}):c.seq([function(a){return c.ct(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])})).then(function(a){return d[15]=a})},function(a){return d[16]="",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]",d[16],"Exactly 1 entry is expected in client_state_table. Found = ",d[16],c.i64.to_string(d[15])].join(""))}])}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Finishing execution.")}])},function(a){return d[10]=f}]):(g=e.item,d[12]=new c.Map(),d[12].set("epoch_id",g.a),d[12].set("epoch_root_key",g.d),d[12].set("epoch_anon_id",g.c),d[10]=d[12])})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Finishing execution."),d[9]=d[10]}])},function(e){return d[9]!==f?c.seq([function(a){return c.seq([function(a){return c.ct(c.db.table(169).fetch()).then(function(a){return d[61]=a})},function(a){return c.i64.gt(d[61],[0,1])?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Multiple rows in $epoch_tables."):0}])},function(a){return c.nop(b("LSCreateSignatureKeyPair.bs")).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],a})},function(a){return c.nop(b("LSCreateEncryptionKeyPair.bs")).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return c.nop(b("LSCreateSignature_v2.bs"),d[10],c.blob("MA=="),d[13]).then(function(a){return a=a,d[14]=a[0],a})},function(b){return d[59]=c.blob(""),d[60]=c.blob(""),c.db.table(168).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Row with backupid not found in client state table"),a=[d[59],d[60],f,c.blob("")],d[15]=a[0],d[16]=a[1],d[17]=a[2],d[18]=a[3],a):(e=b.item,a=[e.h,e.f,e.j,e.g],d[15]=a[0],d[16]=a[1],d[17]=a[2],d[18]=a[3],a)})},function(a){return c.blobs.eq(d[15],d[59])?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]oblivious_token is empty!"):0,c.blobs.eq(d[16],d[60])?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]mailbox_root_key is empty!"):0,d[20]=d[9].get("epoch_anon_id"),d[9],d[21]=d[9].get("epoch_root_key"),d[9],d[22]=c.createArray(),d[22].push([0,32]),d[22],c.nop(b("LSBase64Encode.bs"),d[20]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[23]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_devices","_",d[23]].join("")),f,d[21],d[22]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[61],[0,0]).then(function(a){return a=a,d[62]=a[0],a})},function(a){return d[24]=d[62]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[24]=d[61]}])},function(a){return c.nop(b("LSHmac_v2.bs"),d[24],d[11]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.blobs.neq(d[25],f)?c.resolve(d[26]=d[25]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]device_epoch_hmac is null!"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[26]=d[61]}])},function(a){return c.nop(b("LSOcmfClientEvolve_v2.bs"),d[18]).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[10]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[8],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[29]).then(function(a){return a=a,d[30]=a[0],a})},function(a){return d[30]!==f?d[31]=d[30]:d[31]="",d[31]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_device_private_key is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[12]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[8],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]!==f?d[34]=d[33]:d[34]="",d[34]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_epoch_storage_private_key is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[27]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[8],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]!==f?d[37]=d[36]:d[37]="",d[37]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_ocmf_client_state_crypto is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[15]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[8],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[38]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]!==f?d[40]=d[39]:d[40]="",d[40]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_oblivious_validation_token is empty!"):0,c.nop(b("LSBase64Encode.bs"),d[16]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[8],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]!==f?d[43]=d[42]:d[43]="",d[43]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_mailbox_root_key is empty!"):0,d[44]=d[9].get("epoch_anon_id"),d[9],c.nop(b("LSBase64Encode.bs"),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[8],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]!==f?d[47]=d[46]:d[47]="",d[47]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_epoch_anon_id is empty!"):0,d[48]=d[9].get("epoch_root_key"),d[9],c.nop(b("LSBase64Encode.bs"),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nop(b("LSSymmetricEncryptionCreateEncryptedString.bs"),d[8],c.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]!==f?d[51]=d[50]:d[51]="",d[51]===""?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]encrypted_epoch_root_key is empty!"):0,d[52]=new c.Map(),d[52].set("encrypted_device_private_key",d[31]),d[52].set("encrypted_epoch_storage_private_key",d[34]),d[52].set("encrypted_ocmf_client_state",d[37]),d[52].set("encrypted_oblivious_validation_token_blob",d[40]),d[52].set("encrypted_mailbox_root_key_blob",d[43]),d[52].set("encrypted_epoch_anon_id",d[47]),d[52].set("encrypted_epoch_root_key",d[51]),c.nop(b("LSBase64Encode.bs"),d[7]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[11]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[13]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[14]==null?c.blob("bnVsbA=="):d[14]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[26]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[28]).then(function(a){return a=a,d[58]=a[0],a})},function(e){return c.i64.neq(d[17],f)?(d[61]=d[9].get("epoch_id"),d[9],d[62]=new c.Map(),d[62].set("backup_id",a[0]),d[62].set("request_device_id",d[17]),d[62].set("virtual_device_id",d[53]==null?"":d[53]),d[62].set("encrypted_secret_values",d[52]),d[62].set("public_key",d[54]==null?"":d[54]),d[62].set("epoch_storage_pubkey",d[55]==null?"":d[55]),d[62].set("epoch_storage_pubkey_sig",d[56]==null?"":d[56]),d[62].set("device_epoch_hmac",d[57]==null?"":d[57]),d[62].set("ocmf_rotation_token",d[58]==null?"":d[58]),d[62].set("is_init",d[1]),d[62].set("epoch_id",d[61]),d[63]=c.toJSON(d[62]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50004],d[63],f,f,[0,0],f)):c.seq([function(b){return c.fe(c.db.table(168).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Device id is null")}])}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Epoch keys are unavailable."),d[1]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Deleting backup due to error"),c.sp(b("LSDeleteBackups"),a[0])):c.resolve())}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Invalid Recovery Code Provided"),d[1]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Deleting backup due to error"),c.sp(b("LSDeleteBackups"),a[0])):c.resolve()):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Invalid Recovery Code Provided"),d[1]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Deleting backup due to error"),c.sp(b("LSDeleteBackups"),a[0])):c.resolve())}]))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsCreateVirtualDeviceV2StoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDecryptMessage",["LSArrayGetObjectAtV2","LSBase64Decode.bs","LSBase64Encode.bs","LSBinaryToHex.bs","LSCreateDerivedKeys.bs","LSGetBlobFromString.bs","LSSymmetricEncryptionCreateDecryptedString.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[f,f,f,f,f],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c):(b=a.item,c=[b.a,b.j,b.f,b.g,b.n],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c)})},function(e){return d[8]=a[5]==null?[0,0]:a[5],c.blobs.neq(a[6],f)?c.resolve(d[6]=a[6]):c.seq([function(e){return c.nop(b("LSBase64Decode.bs"),a[2]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return c.blobs.neq(d[9],f)?d[10]=d[9]:d[10]=f,d[6]=d[10]}])},function(e){return c.i64.neq(a[0],f)?c.seq([function(e){return c.blobs.neq(d[6],f)?c.seq([function(e){return c.i64.neq(d[0],f)?c.seq([function(a){return d[11]=c.createArray(),c.fe(c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.b,d[0])&&c.blobs.eq(a.c,d[6])}),function(a){a=a.item;return d[14]=new c.Map(),d[14].set("epoch_root_key",a.d),d[14].set("epoch_anon_id",a.c),d[11].push(d[14]),d[11]})},function(e){return d[12]=c.i64.of_int32(d[11].length),c.i64.eq(d[12],[0,1])?c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[11],[0,0]).then(function(a){return a=a,d[14]=a[0],a})},function(b){return c.db.table(180).fetch([[[a[0],a[3]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[15]=f:(b=a.item,d[15]=b.c)})},function(e){return d[15]!==f?c.seq([function(a){return d[18]=d[14].get("epoch_anon_id"),d[14],d[19]=d[14].get("epoch_root_key"),d[14],d[20]=c.createArray(),d[20].push([0,32]),d[20],c.nop(b("LSGetBlobFromString.bs"),d[15]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.i64.ge(d[8],[0,2])?(d[27]="_",d[22]=["message_key_in_epoch",d[27],c.blobs.to_string(d[18]),d[27],"cipher_version",d[27],c.i64.to_string(d[8])].join("")):d[22]=["message_key_in_epoch","_",c.blobs.to_string(d[18])].join(""),c.nop(b("LSGetBlobFromString.bs"),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.bs"),d[23],d[21],d[19],d[20]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[24],[0,0]).then(function(a){return a=a,d[25]=a[0],a})},function(e){return c.blobs.neq(d[25],f)?c.seq([function(e){return c.nop(b("LSSymmetricEncryptionCreateDecryptedString.bs"),d[25],c.blobs.of_string(["message_thread","_",d[15]].join("")),a[1]).then(function(a){return a=a,d[27]=a[0],a})},function(e){return d[27]!==f?c.resolve(d[28]=d[27]):c.seq([function(a){return d[29]=c.createArray(),d[29].push([0,32]),d[29],c.nop(b("LSGetBlobFromString.bs"),"epoch_anon_id_debug").then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.bs"),d[30],f,d[18],d[29]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[31],[0,0]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.nop(b("LSBinaryToHex.bs"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[34]=c.createArray(),d[34].push([0,32]),d[34],c.nop(b("LSGetBlobFromString.bs"),"epoch_root_key_debug").then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.bs"),d[35],f,d[19],d[34]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[36],[0,0]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nop(b("LSBinaryToHex.bs"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[39]=c.createArray(),d[39].push([0,32]),d[39],c.nop(b("LSGetBlobFromString.bs"),"message_key_debug").then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.bs"),d[40],f,d[25],d[39]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[41],[0,0]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nop(b("LSBinaryToHex.bs"),d[42]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[19]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nop(b("LSGetBlobFromString.bs"),[d[44],d[15]].join("")).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[46]=c.createArray(),d[46].push([0,32]),d[46],c.nop(b("LSGetBlobFromString.bs"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.bs"),d[47],f,d[45],d[46]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[48],[0,0]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nop(b("LSBinaryToHex.bs"),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(b){return d[51]=":",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]","",["Encoded message encrypt/decrypt values are epoch_anon_id:epoch_root_key:message_key:epoch_root_key+thread_id\n","Encryption values:\n",a[7]==null?"":a[7],"\nDecryption values:\n",[d[33],d[51],d[38],d[51],d[43],d[51],d[50]].join("")].join("")].join("")),d[28]=f}])},function(a){return d[26]=d[28]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]Decryption message key is null"),d[26]=f))},function(a){return d[17]=d[26]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]thread_id is null"),d[17]=f))},function(a){return d[13]=d[17]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]There should be exactly one open epoch per backup."),d[13]=f))},function(a){return d[10]=d[13]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]backup_id is null"),d[10]=f))},function(a){return d[9]=d[10]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]epoch_anon_id is null"),d[9]=f))},function(a){return d[7]=d[9]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]task_id is null"),d[7]=f))},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageStoredProcedure]Finishing execution."),e[0]=d[7]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDecryptAndWriteMessagesToClient",["LSAppendDataTraceAddon","LSArrayGetObjectAtV2","LSDecryptMessage","LSFlushDataTrace.bs","LSRestoreMessagesV2.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(b){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientStoredProcedure]Beginning execution."),d[0]=c.createArray(),d[3]=["restore_messages",".",c.i64.to_string(a[0])].join(""),c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[3]||a.g===d[3]||a.h===d[3]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[5]=f:(b=a.item,d[5]=b.a)})},function(a){return d[1]=d[5]}])},function(a){return d[1]!==f?c.sp(b("LSAppendDataTraceAddon"),d[1],[0,1422],[0,2],f,f):c.resolve()},function(b){return d[4]=["restore_messages",".",c.i64.to_string(a[0])].join(""),c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[4]||a.g===d[4]||a.h===d[4]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[5]=f:(b=a.item,d[5]=b.a)})},function(a){return d[2]=d[5]}])},function(a){return d[2]!==f?c.nop(b("LSFlushDataTrace.bs"),d[2]):c.resolve()},function(e){return c.i64.neq(a[0],f)?c.seq([function(e){return d[5]=c.i64.of_int32(a[1].length),c.i64.gt(d[5],[0,0])?c.loopAsync(d[5],function(e){return d[6]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAtV2"),a[1],d[6]).then(function(a){return a=a,d[7]=a[0],a})},function(e){return d[8]=d[7].get("value"),d[7],d[9]=d[7].get("value_secret_ref"),d[7],d[10]=d[7].get("partial_thread_id"),d[7],d[11]=d[7].get("encryption_version"),d[7],d[12]=d[7].get("epoch_anon_id"),d[7],d[13]=d[7].get("message_encryption_values"),d[7],c.sp(b("LSDecryptMessage"),a[0],d[8],d[9],d[10],a[2],d[11]==null?[0,0]:d[11],d[12],d[13]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]!==f?(d[0].push(d[14]),d[0]):function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientStoredProcedure]Message decryption failed")}])}):c.resolve()},function(e){return a[3]!==f?c.seq([function(b){return c.db.table(180).fetch([[[a[0],a[3]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[6]=f:(b=a.item,d[6]=b.c)})},function(a){return d[6]!==f?c.nop(b("LSRestoreMessagesV2.bs"),"AdvancedCrypto",d[6],d[0],!1,f,!1,f):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientStoredProcedure]raw_thread_id is null"))}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientStoredProcedure]thread_partial_id is null"))}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientStoredProcedure]task_id is null"))},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteMessagesToClientStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDecryptAndWriteThreadsToClient",["LSAppendDataTraceAddon","LSArrayGetObjectAtV2","LSBase64Encode.bs","LSCreateDataTraceID.bs","LSEchoDeserialize.bs","LSFlushDataTrace.bs","LSGetBlobFromString.bs","LSHmac_v2.bs","LSIssueNewTaskAndGetTaskID","LSOcmfClientMap.bs","LSRestoreThreads.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteThreadsToClientStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[f,f,f,f,f],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c):(b=a.item,c=[b.a,b.j,b.f,b.g,b.n],d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],d[4]=c[4],c)})},function(b){return d[8]=["restore_threads",".",c.i64.to_string(a[0])].join(""),c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[8]||a.g===d[8]||a.h===d[8]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[10]=f:(b=a.item,d[10]=b.a)})},function(a){return d[6]=d[10]}])},function(a){return d[6]!==f?c.sp(b("LSAppendDataTraceAddon"),d[6],[0,1419],[0,2],f,f):c.resolve()},function(b){return d[9]=["restore_threads",".",c.i64.to_string(a[0])].join(""),c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[9]||a.g===d[9]||a.h===d[9]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[10]=f:(b=a.item,d[10]=b.a)})},function(a){return d[7]=d[10]}])},function(a){return d[7]!==f?c.nop(b("LSFlushDataTrace.bs"),d[7]):c.resolve()},function(e){return c.blobs.neq(d[3],f)?c.seq([function(e){return d[10]=c.createArray(),d[11]=c.i64.of_int32(a[1].length),c.i64.gt(d[11],[0,0])?c.loopAsync(d[11],function(e){return d[14]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAtV2"),a[1],d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[16]=d[15].get("value"),d[15],d[17]=d[15].get("value_secret_ref"),d[15],d[10].push(d[16]),d[10]}])}):c.resolve()},function(a){return c.nop(b("LSRestoreThreads.bs"),"AdvancedCrypto",d[10]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.nop(b("LSEchoDeserialize.bs"),"AdvancedCrypto")},function(e){return d[13]=c.i64.of_int32(d[12].length),c.i64.gt(d[13],[0,0])?c.loopAsync(d[13],function(e){return d[14]=e,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[12],d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return c.nop(b("LSGetBlobFromString.bs"),d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.bs"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.bs"),d[3],d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.bs"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(e){return d[21]=d[19]==null?"":d[19],c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure]Beginning execution."),c.i64.gt([0,0],[0,0])?d[22]=c.i64.add(c.i64.of_float(Date.now()),[0,0]):d[22]=[0,0],c.sp(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_restore",[0,50015],"",f,f,[0,0],f).then(function(a){return a=a,d[23]=a[0],a})},function(b){return c.db.table(190).add({a:d[23],b:a[2],c:d[21],d:[0,20],e:[0,1]})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure]Finishing execution."),d[20]=d[23]}])},function(a){return c.i64.neq(d[20],f)?c.seq([function(a){return c.nop(b("LSCreateDataTraceID.bs")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[23]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",d[23],"EncryptedBackups Trace ID",d[23],d[22]].join("")),c.db.table(153).add({a:d[22],b:c.i64.of_float(Date.now()),d:[0,73],e:!1,h:["restore_messages",".",c.i64.to_string(d[20])].join("")})},function(a){return d[25]=["restore_messages",".",c.i64.to_string(d[20])].join(""),c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[25]||a.g===d[25]||a.h===d[25]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[26]=f:(b=a.item,d[26]=b.a)})},function(a){return d[24]=d[26]}])},function(a){return d[24]!==f?c.sp(b("LSAppendDataTraceAddon"),d[24],[0,1420],[0,2],f,f):c.resolve()},function(a){return c.db.table(180).add({a:d[20],b:d[21],c:d[15]})}]):c.resolve()}])}):c.resolve()}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteThreadsToClientStoredProcedure]missing ocmf_client_state for restore"))},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptAndWriteThreadsToClientStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDeletePollAttachment",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d;return b.seq([function(c){return b.ftr(b.db.table(38).fetch([[[a[2]]]]),function(c){return b.i64.eq(c.a,a[2])&&b.i64.eq(c.b,a[0])}).next().then(function(c,e){var f=c.done;c=c.value;return f?b.fe(b.ftr(b.db.table(16).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.a,a[0])&&c.e===a[1]&&(b.i64.eq(c.f,[0,7])||b.i64.eq(c.f,[0,0]))&&c.j===!1&&c.l===!0&&b.i64.eq(c.bV,d)}),function(a){return a["delete"]()}):(e=c.item,b.fe(b.ftr(b.db.table(16).fetch([[[a[0],e.c,a[1]]]]),function(c){return b.i64.eq(c.a,a[0])&&b.i64.eq([0,0],[0,0])&&c.c===e.c&&c.e===a[1]&&(b.i64.eq(c.f,[0,7])||b.i64.eq(c.f,[0,0]))&&c.j===!1&&c.l===!0&&b.i64.eq(c.bV,d)}),function(a){return a["delete"]()}))})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSSetThreadImageURL",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d;return b.seq([function(c){return b.fe(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({f:a[1]===""?d:a[1],g:a[2],h:a[3],R:a[4],Q:a[5]})})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSDeleteThenInsertContact",["LSSetThreadImageURL"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(b){return c.i64.eq(a[23],[0,39423])?d[0]=[0,1]:(c.i64.eq(a[23],[0,14342874])?d[1]=[0,2]:d[1]=f,d[0]=d[1]),c.ftr(c.db.table(7).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.eq([0,1],[0,1])&&c.i64.gt(b.J,a[21])}).next().then(function(b){var e=b.done;b.value;return e?c.db.table(7).put({a:a[0],b:a[2],c:a[3],d:a[4],e:a[5],f:a[6],g:a[7],h:a[9],K:a[41],i:a[10],j:a[33],k:a[11],l:a[12],m:a[35],n:a[14],o:a[17],p:a[18],q:a[19],r:a[20],J:a[21],s:a[22],t:a[23],u:a[24],v:a[25],w:a[26],z:a[27],x:a[28],y:a[29],A:a[30],B:a[31],C:a[32],E:a[34],F:a[36],G:a[37],Q:a[38],D:d[0],H:a[39],I:a[40],N:a[43],O:[0,0],P:a[44]}):0})},function(d){return c.sp(b("LSSetThreadImageURL"),a[0],a[2],a[3],a[4],!1,!0)}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDeleteThenInsertMessageRequest",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(34).put({a:a[0],b:a[2]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSDeleteThenInsertRankingRequest",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(135).put({a:a[0],b:a[1]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSDeleteThenInsertRankingScore",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(134).put({a:a[0],d:a[1],b:a[2],c:a[3],e:a[4]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSDeleteThenInsertThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(d){return b.db.table(9).fetch([[[a[7]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?b.db.table(9).put({a:a[7],j:a[1],Z:a[6],b:a[8],c:a[9],e:a[10],u:a[25],A:a[31],i:a[0],m:a[2],d:a[3],f:a[4],t:a[5],g:a[11],h:a[12],k:a[13],l:a[14],bc:a[15],n:a[16],o:a[17],p:a[20],q:a[21],r:a[22],s:a[23],v:a[26],w:a[27],x:a[28],y:a[29],z:a[30],B:a[32],C:a[33],D:a[34],E:a[35],F:a[36],G:a[37],H:a[38],I:a[39],J:a[40],K:a[41],L:a[42],M:a[43],N:a[44],O:a[45],P:a[46],Q:a[47],bn:a[48],R:a[49],S:a[50],T:a[51],U:a[52],V:a[53],W:a[54],X:a[55],Y:a[56],be:a[58],bf:a[59],ba:a[60],bh:a[61]}):(f=d.item,c[1]=f.i,c[3]=f.A,c[2]=f.V,c[4]=f.W,b.i64.le(f.Z,a[6])?b.i64.gt(c[1],a[0])&&b.i64.neq(c[2],e)?(b.i64.eq(a[31],[-1,4294967286])&&b.i64.eq(c[3],[0,0])?(g=[c[3],f.e],c[5]=g[0],c[6]=g[1],g):(d=[a[31],a[10]],c[5]=d[0],c[6]=d[1],d),b.db.table(9).put({a:a[7],j:f.j,Z:a[6],b:a[8],c:a[9],e:c[6],u:a[25],A:c[5],i:c[1],m:a[2],d:a[3],f:a[4],t:a[5],g:a[11],h:a[12],k:a[13],l:a[14],bc:a[15],n:a[16],o:a[17],p:a[20],q:a[21],r:a[22],s:a[23],v:a[26],w:a[27],x:a[28],y:a[29],z:a[30],B:a[32],C:a[33],D:a[34],E:a[35],F:a[36],G:a[37],H:a[38],I:a[39],J:a[40],K:a[41],L:a[42],M:a[43],N:a[44],O:a[45],P:a[46],Q:a[47],bn:a[48],R:a[49],S:a[50],T:a[51],U:a[52],V:c[2],W:c[4],X:a[55],Y:a[56],be:a[58],bf:a[59],ba:a[60],bh:a[61]})):b.db.table(9).put({a:a[7],j:a[1],Z:a[6],b:a[8],c:a[9],e:a[10],u:a[25],A:a[31],i:a[0],m:a[2],d:a[3],f:a[4],t:a[5],g:a[11],h:a[12],k:a[13],l:a[14],bc:a[15],n:a[16],o:a[17],p:a[20],q:a[21],r:a[22],s:a[23],v:a[26],w:a[27],x:a[28],y:a[29],z:a[30],B:a[32],C:a[33],D:a[34],E:a[35],F:a[36],G:a[37],H:a[38],I:a[39],J:a[40],K:a[41],L:a[42],M:a[43],N:a[44],O:a[45],P:a[46],Q:a[47],bn:a[48],R:a[49],S:a[50],T:a[51],U:a[52],V:c[2],W:c[4],X:a[55],Y:a[56],be:a[58],bf:a[59],ba:a[60],bh:a[61]}):b.resolve())})},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSFilteredThreadsRangesQuery",["LSGetCursor","LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return(a[2]&&c.i64.neq(a[7],f)&&c.i64.neq(a[4],f)||a[3]&&c.i64.neq(a[6],f)&&c.i64.neq(a[5],f))&&!(a[2]&&c.i64.neq(a[7],f)&&c.i64.neq(a[4],f)&&a[3]&&c.i64.neq(a[6],f)&&c.i64.neq(a[5],f))?c.seq([function(e){return d[6]=a[4]==null?[-2147483648,0]:a[4],d[7]=a[7]==null?[0,1]:a[7],d[8]=c.i64.gt(d[7],[0,1])&&c.i64.gt(d[6],[-2147483648,0]),c.sp(b("LSGetCursor"),[0,1]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return d[1]=new c.Map(),d[1].set("cursor",d[0]),d[1].set("filter",a[1]),d[1].set("is_after",a[3]),d[1].set("parent_thread_key",a[0]),d[1].set("reference_activity_timestamp",a[3]?a[6]:a[7]),d[1].set("reference_thread_key",a[3]?a[5]:a[4]),c.i64.gt([0,0],[0,0])?d[2]=c.i64.add(c.i64.of_float(Date.now()),[0,0]):d[2]=[0,0],d[3]=c.toJSON(d[1]),c.sp(b("LSIssueNewTaskAndGetTaskID"),"trq",[0,313],d[3],f,f,[0,0],f).then(function(a){return a=a,d[4]=a[0],a})},function(b){return c.ftr(c.db.table(159).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.eq(b.j,a[1])}).next().then(function(b,e){e=b.done;b=b.value;return e?c.db.table(159).add({k:"",a:a[0],b:d[6],c:d[7],j:a[1],e:[0,1],d:[-2147483648,0],f:d[8],g:!1,h:d[8],i:!1}):(b.item,c.fe(c.ftr(c.db.table(159).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.eq(b.j,a[1])}),function(a){var b=a.update;a.item;return b({f:!0,g:!1,h:d[8],i:!1})}))})}]):c.resolve()},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSGetFirstAvailableAttachmentCTAID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return b.seq([function(a){return b.seq([function(a){return b.db.table(19).fetchDesc().next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=[0,1]:(d=a.item,c[0]=b.i64.add(d.a,[0,1]))})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSGetFirstAvailableQuickReplyCTAID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return b.seq([function(a){return b.seq([function(a){return b.sb(b.db.table(20).fetch(),[["c","DESC"]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=[0,1]:(d=a.item,c[0]=b.i64.add(d.c,[0,1]))})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSHandleAddDeviceSuccess",["LSAppendDataTraceAddon","LSFlushDataTrace.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleAddDeviceSuccessStoredProcedure]Beginning execution."),d[3]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[3]||a.g===d[3]||a.h===d[3]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[5]=f:(b=a.item,d[5]=b.a)})},function(a){return d[0]=d[5]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1416],[0,2],f,f):c.resolve()},function(b){return c.ftr(c.db.table(168).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.a,a[0])&&c.blobs.eq(b.b,a[2])}).next().then(function(b,d){d=b.done;b=b.value;return d?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleAddDeviceSuccessStoredProcedure]handleAddDeviceSuccess: no matching row in backup client state found."):(b.item,c.seq([function(b){return c.fe(c.db.table(168).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({j:a[1],i:[0,80]})})},function(b){return c.fe(c.ftr(c.db.table(169).fetch(),function(b){return c.i64.eq(a[0],b.b)}),function(a){var b=a.update;a.item;return b({f:[0,80]})})}]))})},function(a){return d[4]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[4]||a.g===d[4]||a.h===d[4]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[5]=f:(b=a.item,d[5]=b.a)})},function(a){return d[2]=d[5]}])},function(a){return d[2]!==f?c.nop(b("LSFlushDataTrace.bs"),d[2]):c.resolve()},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleAddDeviceSuccessStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOpenEpoch",["LSAppendDataTraceAddon","LSArrayGetObjectAtV2","LSBase64Encode.bs","LSCreateDerivedKeys.bs","LSCreateSymmetricEncryptionSecretKey.bs","LSGetBlobFromString.bs","LSGetNextEpochAnonId.bs","LSHmac_v2.bs","LSIssueNewTask","LSPublicEncryptionCreateEncryptedData.bs","LSSymmetricEncryptionCreateEncryptedString.bs","LSVerifySignature_v2.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]Beginning execution."),d[4]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[4]||a.g===d[4]||a.h===d[4]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[5]=f:(b=a.item,d[5]=b.a)})},function(a){return d[0]=d[5]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1405],[0,2],f,f):c.resolve()},function(b){return c.db.table(168).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[1]=f:(b=a.item,d[6]=b.j,c.i64.neq(d[6],f)?(d[7]=new c.Map(),d[7].set("epoch_auth_public_key_blob",b.l),d[7].set("epoch_auth_private_key_blob",b.k),d[7].set("device_id",d[6]),d[5]=d[7]):d[5]=f,d[1]=d[5])})},function(e){return d[1]?d[3]=!1:d[3]=!0,d[3]?c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]Unable to fetch client state.")):c.seq([function(a){return c.ct(c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.f,[0,80])})).then(function(a){return d[5]=a})},function(e){return d[7]=c.i64.eq(d[5],[0,0]),c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.e,[0,1])}).next().then(function(e,g){var h=e.done;e=e.value;return h?c.seq([function(a){return c.nop(b("LSGetNextEpochAnonId.bs"),f).then(function(a){return a=a,d[8]=a[0],a})},function(a){return c.nop(b("LSCreateSymmetricEncryptionSecretKey.bs")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[10]=c.i64.random(),c.fe(c.ftr(c.db.table(169).fetch([[[d[10]]]]),function(a){return c.i64.eq(a.a,d[10])&&c.i64.lt(a.f,[0,20])}),function(a){return a["delete"]()})},function(b){return c.db.table(169).add({a:d[10],b:a[0],e:[0,1],d:d[9],c:d[8],f:[0,20]})},function(a){return d[11]=c.createArray(),d[11].push([0,32]),d[11],c.nop(b("LSBase64Encode.bs"),d[8]).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[12]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_data_storage","_",d[12]].join("")),f,d[9],d[11]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[20],[0,0]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[13]=d[21]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[13]=d[20]}])},function(e){return d[14]=c.createArray(),d[15]=c.i64.of_int32(a[1].length),c.i64.gt(d[15],[0,0])?c.loopAsync(d[15],function(e){return d[20]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAtV2"),a[1],d[20]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[22]=d[21].get("public_key"),d[21],c.nop(b("LSBase64Encode.bs"),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[24]=d[21].get("public_key"),d[21],d[25]=c.createArray(),d[25].push([0,32]),d[25],c.nop(b("LSBase64Encode.bs"),d[8]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_devices","_",d[26]].join("")),f,d[9],d[25]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[32],[0,0]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[27]=d[33]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[27]=d[32]}])},function(a){return c.nop(b("LSHmac_v2.bs"),d[27],d[24]).then(function(a){return a=a,d[28]=a[0],a})},function(a){var e;return c.seq([function(a){return d[32]=d[21].get("device_id"),d[21],c.blobs.neq(d[28],f)?c.seq([function(a){return c.nop(b("LSBase64Encode.bs"),d[28]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[33]=d[39]}]):c.resolve(d[33]=f)},function(a){return d[34]=d[21].get("public_key"),d[21],d[35]=d[21].get("epoch_storage_public_key"),d[21],d[36]=d[21].get("epoch_storage_public_key_sig"),d[21],c.blobs.neq(f,f)?c.seq([function(a){return c.blobs.neq(d[35],f)?c.seq([function(a){return c.blobs.neq(d[36],f)?c.seq([function(a){return c.nop(b("LSVerifySignature_v2.bs"),d[34],d[36],c.blob("MA=="),d[35]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?c.seq([function(a){return d[43]=d[1].get("epoch_auth_public_key_blob"),d[1],d[44]=d[1].get("epoch_auth_private_key_blob"),d[1],c.nop(b("LSPublicEncryptionCreateEncryptedData.bs"),d[35],d[43],d[44],f,c.blobs.of_string(["epoch_","_",c.blobs.to_string(d[8])].join("")),f).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.blobs.neq(d[45],f)?c.seq([function(a){return c.nop(b("LSBase64Encode.bs"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[46]=d[47]}]):c.resolve(d[46]=f)},function(a){return d[42]=d[46]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]Signature verification failed."),d[42]=f))},function(a){return d[40]=d[42]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]$other_device_epoch_storage_public_key_sig is null."),d[40]=f))},function(a){return d[39]=d[40]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]$other_device_epoch_storage_public_key is null."),d[39]=f))},function(a){return d[37]=d[39]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]$epoch_entropy is null."),d[37]=f))},function(a){return d[38]=new c.Map(),d[38].set("device_pub",d[23]==null?"":d[23]),d[38].set("hmac",d[33]==null?"":d[33]),d[38].set("encrypted_epoch_key",d[37]),a=[d[32],d[38]],d[29]=a[0],d[30]=a[1],a}])},function(a){return d[31]=new c.Map(),d[31].set("device_id",d[29]),d[31].set("membership",d[30]),d[14].push(d[31]),d[14]}])}):c.resolve()},function(a){return d[16]=d[1].get("device_id"),d[1],c.nop(b("LSBase64Encode.bs"),d[8]).then(function(a){return a=a,d[17]=a[0],a})},function(e){return d[18]=new c.Map(),d[18].set("backup_id",a[0]),d[18].set("epoch_data",""),d[18].set("epoch_device_list",d[14]),d[18].set("optimistic_epoch_id",d[10]),d[18].set("is_init",d[7]),d[18].set("epoch_data_v2",f),d[18].set("last_epoch_id",f),d[18].set("device_id",d[16]),d[18].set("epoch_anon_id",d[17]==null?"":d[17]),d[19]=c.toJSON(d[18]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,320],d[19],f,f,[0,0],f)}]):(g=e.item,d[8]=g.c,d[9]=g.d,c.i64.eq(g.f,[0,20])?c.seq([function(a){return d[10]=c.createArray(),d[10].push([0,32]),d[10],c.nop(b("LSBase64Encode.bs"),d[8]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_data_storage","_",d[11]].join("")),f,d[9],d[10]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[19],[0,0]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[12]=d[20]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[12]=d[19]}])},function(e){return d[13]=c.createArray(),d[14]=c.i64.of_int32(a[1].length),c.i64.gt(d[14],[0,0])?c.loopAsync(d[14],function(e){return d[19]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAtV2"),a[1],d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[21]=d[20].get("public_key"),d[20],c.nop(b("LSBase64Encode.bs"),d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[23]=d[20].get("public_key"),d[20],d[24]=c.createArray(),d[24].push([0,32]),d[24],c.nop(b("LSBase64Encode.bs"),d[8]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[25]!==f?c.seq([function(a){return c.nop(b("LSCreateDerivedKeys.bs"),c.blobs.of_string(["epoch_devices","_",d[25]].join("")),f,d[9],d[24]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[31],[0,0]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[26]=d[32]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),c.nop(b("LSGetBlobFromString.bs"),"").then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[26]=d[31]}])},function(a){return c.nop(b("LSHmac_v2.bs"),d[26],d[23]).then(function(a){return a=a,d[27]=a[0],a})},function(a){var e;return c.seq([function(a){return d[31]=d[20].get("device_id"),d[20],c.blobs.neq(d[27],f)?c.seq([function(a){return c.nop(b("LSBase64Encode.bs"),d[27]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[32]=d[38]}]):c.resolve(d[32]=f)},function(a){return d[33]=d[20].get("public_key"),d[20],d[34]=d[20].get("epoch_storage_public_key"),d[20],d[35]=d[20].get("epoch_storage_public_key_sig"),d[20],c.blobs.neq(f,f)?c.seq([function(a){return c.blobs.neq(d[34],f)?c.seq([function(a){return c.blobs.neq(d[35],f)?c.seq([function(a){return c.nop(b("LSVerifySignature_v2.bs"),d[33],d[35],c.blob("MA=="),d[34]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?c.seq([function(a){return d[42]=d[1].get("epoch_auth_public_key_blob"),d[1],d[43]=d[1].get("epoch_auth_private_key_blob"),d[1],c.nop(b("LSPublicEncryptionCreateEncryptedData.bs"),d[34],d[42],d[43],f,c.blobs.of_string(["epoch_","_",c.blobs.to_string(d[8])].join("")),f).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.blobs.neq(d[44],f)?c.seq([function(a){return c.nop(b("LSBase64Encode.bs"),d[44]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[45]=d[46]}]):c.resolve(d[45]=f)},function(a){return d[41]=d[45]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]Signature verification failed."),d[41]=f))},function(a){return d[39]=d[41]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]$other_device_epoch_storage_public_key_sig is null."),d[39]=f))},function(a){return d[38]=d[39]}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]$other_device_epoch_storage_public_key is null."),d[38]=f))},function(a){return d[36]=d[38]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]$epoch_entropy is null."),d[36]=f))},function(a){return d[37]=new c.Map(),d[37].set("device_pub",d[22]==null?"":d[22]),d[37].set("hmac",d[32]==null?"":d[32]),d[37].set("encrypted_epoch_key",d[36]),a=[d[31],d[37]],d[28]=a[0],d[29]=a[1],a}])},function(a){return d[30]=new c.Map(),d[30].set("device_id",d[28]),d[30].set("membership",d[29]),d[13].push(d[30]),d[13]}])}):c.resolve()},function(a){return d[15]=d[1].get("device_id"),d[1],c.nop(b("LSBase64Encode.bs"),d[8]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[17]=new c.Map(),d[17].set("backup_id",a[0]),d[17].set("epoch_data",""),d[17].set("epoch_device_list",d[13]),d[17].set("optimistic_epoch_id",g.a),d[17].set("is_init",d[7]),d[17].set("epoch_data_v2",f),d[17].set("last_epoch_id",f),d[17].set("device_id",d[15]),d[17].set("epoch_anon_id",d[16]==null?"":d[16]),d[18]=c.toJSON(d[17]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,320],d[18],f,f,[0,0],f)}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]Open epoch with authoritative level is present, epoch needs to be closed before opening a new one")))})}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOpenEpochStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSHandleCreateBackupMailboxSuccess",["LSAppendDataTraceAddon","LSOpenEpoch"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateBackupMailboxSuccessStoredProcedure]Beginning execution."),d[2]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[2]||a.g===d[2]||a.h===d[2]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[3]=f:(b=a.item,d[3]=b.a)})},function(a){return d[0]=d[3]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1404],[0,2],f,f):c.resolve()},function(a){return c.db.table(168).fetch().next().then(function(a,e){var g=a.done;a=a.value;return g?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateBackupMailboxSuccessStoredProcedure]No row in the client state table. Aborting backup initialization."):(e=a.item,d[3]=e.j,c.i64.neq(d[3],f)?(d[4]=new c.Map(),d[4].set("device_id",d[3]),d[4].set("public_key",e.b),d[5]=c.createArray(),d[5].push(d[4]),d[5],c.sp(b("LSOpenEpoch"),e.a,d[5],f)):c.resolve())})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateBackupMailboxSuccessStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSHandleCreateVirtualDeviceSuccess",["LSAppendDataTraceAddon","LSFlushDataTrace.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceSuccessStoredProcedure]Beginning execution."),d[2]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[2]||a.g===d[2]||a.h===d[2]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[4]=f:(b=a.item,d[4]=b.a)})},function(a){return d[0]=d[4]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1411],[0,2],f,f):c.resolve()},function(e){return a[1]?c.seq([function(a){return d[5]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[5]||a.g===d[5]||a.h===d[5]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[6]=f:(b=a.item,d[6]=b.a)})},function(a){return d[4]=d[6]}])},function(a){return d[4]!==f?c.nop(b("LSFlushDataTrace.bs"),d[4]):c.resolve()},function(b){return c.fe(c.ftr(c.db.table(168).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.a,a[0])&&c.i64.eq(b.i,[0,20])}),function(a){var b=a.update;a.item;return b({i:[0,80]})})},function(b){return c.fe(c.ftr(c.db.table(169).fetch(),function(b){return c.i64.eq(b.b,a[0])&&c.i64.eq(b.f,[0,20])}),function(a){var b=a.update;a.item;return b({f:[0,80]})})},function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceSuccessStoredProcedure]initiateRetroactiveBackup native op not supported")}]):c.resolve()},function(a){return c.db.table(178).put({a:[0,1],b:[0,2]})},function(a){return c.fe(c.db.table(174).fetch([[[[0,1]]]]),function(a){return a["delete"]()})},function(a){return d[3]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[3]||a.g===d[3]||a.h===d[3]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[4]=f:(b=a.item,d[4]=b.a)})},function(a){return d[1]=d[4]}])},function(a){return d[1]!==f?c.nop(b("LSFlushDataTrace.bs"),d[1]):c.resolve()},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceSuccessStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSHandleDeleteMailbox",["LSAppendDataTraceAddon","LSDeleteBackupOnClient","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleDeleteMailboxStoredProcedure]Beginning execution."),d[1]="delete_backup",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[1]||a.g===d[1]||a.h===d[1]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=f:(b=a.item,d[2]=b.a)})},function(a){return d[0]=d[2]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1425],[0,2],f,f):c.resolve()},function(e){return a[0]===!0?c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueDeleteBackupTaskStoredProcedure]Beginning execution."),d[9]="delete_backup",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[9]||a.g===d[9]||a.h===d[9]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[10]=f:(b=a.item,d[10]=b.a)})},function(a){return d[2]=d[10]}])},function(a){return d[2]!==f?c.sp(b("LSAppendDataTraceAddon"),d[2],[0,1426],[0,2],f,f):c.resolve()},function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[f,f,f,f,f],d[3]=c[0],d[4]=c[1],d[5]=c[2],d[6]=c[3],d[7]=c[4],c):(b=a.item,c=[b.a,b.j,b.f,b.g,b.n],d[3]=c[0],d[4]=c[1],d[5]=c[2],d[6]=c[3],d[7]=c[4],c)})},function(a){return c.i64.neq(d[3],f)?(d[10]=new c.Map(),d[10].set("backup_id",d[3]),d[11]=c.toJSON(d[10]),c.sp(b("LSIssueNewTask"),"encrypted_backups_setup",[0,50011],d[11],f,f,[0,0],f)):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsIssueDeleteBackupTaskStoredProcedure]backup_id is null, clearing client state"),c.sp(b("LSDeleteBackupOnClient"),f))},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueDeleteBackupTaskStoredProcedure]Finishing execution.")}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleDeleteMailboxStoredProcedure]Mailbox deletion failed, not deleting the backup"))},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleDeleteMailboxStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSHandleFailedTask",["LSHandleTaskSendFailureForQueue"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e;return c.seq([function(d){return function(a){c.logger(a).mustfix(a)}(a[2]),a[1]!==e?c.sp(b("LSHandleTaskSendFailureForQueue"),a[1]):c.resolve()},function(a){return c.resolve(d)}])}e.exports=a}),null);
__d("LSHandlePlaceholderPollData",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(38).fetch([[[a[0]]]]).next().then(function(c,d){var e=c.done;c=c.value;return e?0:(d=c.item,b.ftr(b.db.table(38).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.a,a[0])&&b.i64.gt(c.f,[0,80])}).next().then(function(e){var c=e.done;e.value;return c?b.db.table(38).put({a:a[0],f:[0,80],b:d.b,c:d.c,d:d.d,e:d.e,g:[0,0],h:[0,1]}):0}))})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSHandleRemoveDeviceFailure",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return function(a){b.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleRemoveDeviceFailureStoredProcedure]Beginning execution."),function(a){b.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleRemoveDeviceFailureStoredProcedure]Error trying to remove device from backup."),function(a){b.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleRemoveDeviceFailureStoredProcedure]Finishing execution."),b.resolve(c)}e.exports=a}),null);
__d("LSHandleRemoveDeviceSuccess",["LSDeleteBackupOnClient"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e;return c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleRemoveDeviceSuccessStoredProcedure]Beginning execution."),c.sp(b("LSDeleteBackupOnClient"),e)},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleRemoveDeviceSuccessStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(d)}])}e.exports=a}),null);
__d("LSHandlerOpenEpochFailure",["LSAppendDataTraceAddon"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandlerOpenEpochFailureStoredProcedure]Beginning execution."),d[1]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[1]||a.g===d[1]||a.h===d[1]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=f:(b=a.item,d[2]=b.a)})},function(a){return d[0]=d[2]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1407],[0,2],f,f):c.resolve()},function(b){return c.fe(c.db.table(169).fetch([[[a[0]]]]),function(a){return a["delete"]()})},function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandlerOpenEpochFailureStoredProcedure]backup_id/is_init param is null"),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandlerOpenEpochFailureStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSHandlerOpenEpochSuccess",["LSAppendDataTraceAddon","LSCreateVirtualDeviceV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandlerOpenEpochSuccessStoredProcedure]Beginning execution."),d[1]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[1]||a.g===d[1]||a.h===d[1]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=f:(b=a.item,d[2]=b.a)})},function(a){return d[0]=d[2]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1406],[0,2],f,f):c.resolve()},function(d){return a[3]?c.seq([function(b){return c.fe(c.db.table(169).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({a:a[1]})})},function(d){return c.sp(b("LSCreateVirtualDeviceV2"),a[2])}]):c.fe(c.db.table(169).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({a:a[1],f:[0,80]})})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandlerOpenEpochSuccessStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSInitializeBackupSuccess",["LSAppendDataTraceAddon","LSCreateBackupMailbox"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupSuccessStoredProcedure]Beginning execution."),d[1]="backup_init_flow",c.seq([function(a){return c.ftr(c.db.table(153).fetch(),function(a){return a.f===d[1]||a.g===d[1]||a.h===d[1]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=f:(b=a.item,d[2]=b.a)})},function(a){return d[0]=d[2]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1401],[0,2],f,f):c.resolve()},function(b){return c.fe(c.db.table(168).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({a:a[1],j:a[2]})})},function(b){return c.i64.neq(a[1],a[0])?c.fe(c.ftr(c.db.table(169).fetch(),function(a){return!0}),function(a){return a["delete"]()}):c.resolve()},function(d){return c.sp(b("LSCreateBackupMailbox"),a[1])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupSuccessStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSInsertAttachment",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.seq([function(c){return b.fe(b.ftr(b.db.table(16).fetch([[[a[32],a[37],a[39]]]]),function(c){return b.i64.eq(c.a,a[32])&&b.i64.eq([0,0],a[33])&&c.c===a[37]&&c.e===a[39]&&b.i64.lt(c.bU,a[108])}),function(a){return a["delete"]()})},function(c){return b.db.table(16).add({a:a[32],c:a[37],e:a[39],j:a[3],k:a[4],f:a[34],b:a[36],l:a[40],bU:a[108],h:a[1],i:a[2],A:a[5],B:a[6],C:a[7],D:a[8],E:a[9],F:a[10],G:a[11],H:a[12],I:a[13],J:a[15],K:a[16],L:a[17],P:a[18],X:a[19],Y:a[20],Z:a[21],ba:a[22],bb:a[23],bc:a[24],bd:a[25],be:a[26],bi:a[27],bj:a[28],bk:a[29],bJ:a[30],bT:a[31],d:a[38],m:a[41],n:a[42],o:a[43],p:a[44],q:a[45],r:a[47],s:a[48],t:a[49],u:a[51],v:a[52],w:a[53],x:a[55],y:a[56],z:a[57],M:a[58],N:a[59],O:a[60],Q:a[61],R:a[62],S:a[63],T:a[64],U:a[65],V:a[66],W:a[67],bf:a[68],bg:a[69],bh:a[70],g:a[71],bl:a[73],bm:a[74],bn:a[75],bo:a[76],bp:a[77],bq:a[78],br:a[79],bs:a[80],bt:a[81],bv:a[82],bw:a[83],bx:a[84],by:a[85],bz:a[86],bA:a[87],bC:a[88],bD:a[89],bE:a[90],bF:a[91],bG:a[92],bH:a[93],bK:a[94],bO:a[95],bP:a[96],bL:a[97],bM:a[98],bN:a[99],bQ:a[100],bR:a[101],bS:a[102],bV:a[106],bW:a[107]})}])},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSInsertAttachmentItem",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(18).add({a:a[0],b:a[1],c:a[2],d:a[4],y:a[30],e:a[7],f:a[8],g:a[9],h:a[12],i:a[13],j:a[14],k:a[15],l:a[16],m:a[17],n:a[18],o:a[19],p:a[20],q:a[21],r:a[22],s:a[23],t:a[24],u:a[25],v:a[26],w:a[28],x:a[29],z:a[32],A:a[34],B:a[35],C:a[36],D:a[38],E:a[39],F:a[40],G:a[42],H:a[43],I:a[44],J:a[45],K:a[46],L:a[47],M:a[48]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSInsertBlobAttachment",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d;return b.seq([function(c){return b.seq([function(c){return b.fe(b.ftr(b.db.table(16).fetch([[[a[27],a[32],a[34]]]]),function(c){return b.i64.eq(c.a,a[27])&&b.i64.eq([0,0],a[28])&&c.c===a[32]&&c.e===a[34]&&b.i64.lt(c.bU,a[48])&&(b.i64.eq(c.f,[0,2])||b.i64.eq(c.f,[0,3])||b.i64.eq(c.f,[0,4])||b.i64.eq(c.f,[0,5])||b.i64.eq(c.f,[0,6])||b.i64.eq(c.f,[0,10]))&&b.i64.eq(c.bV,d)&&c.k===!1}),function(a){return a["delete"]()})},function(c){return b.db.table(16).add({a:a[27],c:a[32],e:a[34],h:a[0],i:a[1],j:a[2],k:!1,A:a[3],B:a[4],C:a[5],D:a[6],E:a[7],F:a[8],G:a[9],H:a[10],I:a[11],J:a[13],K:a[14],L:a[15],X:a[16],Y:a[17],Z:a[18],ba:a[19],bb:a[20],bc:a[21],bd:a[22],be:a[23],bj:a[24],bk:a[25],bJ:a[26],f:a[29],b:a[31],d:a[33],l:a[35],m:a[36],n:a[37],R:a[38],S:a[39],V:a[40],W:a[41],bh:a[42],bK:a[44],bY:a[45],bU:a[48]})}])},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSInsertXmaAttachment",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d;return b.seq([function(c){return b.seq([function(c){return b.fe(b.ftr(b.db.table(16).fetch([[[a[25],a[30],a[32]]]]),function(c){return b.i64.eq(c.a,a[25])&&b.i64.eq([0,0],a[26])&&c.c===a[30]&&c.e===a[32]&&b.i64.lt(c.bU,a[106])&&(b.i64.eq(c.f,[0,7])||b.i64.eq(c.f,[0,0]))&&c.j===!1&&c.l===!0&&b.i64.eq(c.bV,d)}),function(a){return a["delete"]()})},function(c){return b.db.table(16).add({a:a[25],c:a[30],e:a[32],h:a[1],i:a[2],j:!1,k:a[3],A:a[4],B:a[5],C:a[6],D:a[7],F:a[8],G:a[9],H:a[10],I:a[11],K:a[13],L:a[14],X:a[15],Y:a[16],Z:a[17],ba:a[18],bb:a[19],be:a[20],bj:a[21],bT:a[22],cb:a[23],bX:a[24],f:a[27],b:a[29],d:a[31],l:!0,m:a[33],n:a[34],o:a[35],p:a[36],q:a[37],r:a[39],s:a[40],t:a[41],u:a[43],v:a[44],w:a[45],x:a[47],y:a[48],z:a[49],M:a[50],N:a[51],O:a[52],Q:a[53],R:a[54],S:a[55],T:a[56],U:a[57],V:a[58],W:a[59],bf:a[60],bg:a[61],bh:a[62],bl:a[64],bm:a[65],cd:a[66],bn:a[67],bo:a[68],bp:a[69],bq:a[70],br:a[71],bs:a[72],bt:a[73],bu:a[74],bv:a[75],bw:a[76],bx:a[77],by:a[78],bz:a[79],bA:a[80],bB:a[81],bC:a[82],bD:a[83],bE:a[84],bF:a[85],bG:a[86],bH:a[87],bI:a[88],bK:a[92],bO:a[93],bP:a[94],bL:a[95],bM:a[96],bN:a[97],bQ:a[98],bR:a[99],bS:a[100],cs:a[103],bY:a[105],bU:a[106]})}])},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSIssueInsertPersistentMenuItemsForThreadTask",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[1]=c.toJSON(d[0]),c.sp(b("LSIssueNewTask"),"insert_persistent_menu_items",[0,117],d[1],f,f,[0,0],f)},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSRemoveDevice",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsRemoveDeviceStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,e){var g=a.done;a=a.value;return g?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsRemoveDeviceStoredProcedure]Could not find backup or device"):(e=a.item,d[2]=e.a,d[1]=e.j,c.i64.neq(d[1],f)?(d[3]=new c.Map(),d[3].set("backup_id",d[2]),d[3].set("device_id",d[1]),d[4]=c.toJSON(d[3]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50009],d[4],f,f,[0,0],f)):c.fe(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.a,d[2])}),function(a){return a["delete"]()}))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsRemoveDeviceStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSRemoveTask",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(c,d){var e=c.done;c=c.value;return e?0:(d=c.item,b.fe(b.ftr(b.db.table(2).fetch([[[{lte:a[0]}]]]),function(c){return b.i64.le(c.a,a[0])&&c.b===d.b}),function(a){return a["delete"]()}))})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSSetMessageTextHasLinks",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.ftr(b.db.table(12).fetch([[[a[0],a[2],a[1]]]]),function(c){return b.i64.eq(c.a,a[0])&&b.i64.eq([0,0],[0,0])&&b.i64.eq(c.b,a[2])&&c.e===a[1]}),function(a){var b=a.update;a.item;return b({O:!0})})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSSetRegionHint",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(1).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({j:a[1]})})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSTaskExists",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return b.seq([function(e){return b.seq([function(d){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?c[0]=!1:(a.item,c[0]=!0)})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSUpdateBackupsTable",["LSArrayGetObjectAtV2","LSDeleteBackupOnClient"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure]Beginning execution."),a[0]?c.seq([function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.i,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[f,f,f,f,f],d[2]=c[0],d[3]=c[1],d[4]=c[2],d[5]=c[3],d[6]=c[4],c):(b=a.item,c=[b.a,b.j,b.f,b.g,b.n],d[2]=c[0],d[3]=c[1],d[4]=c[2],d[5]=c[3],d[6]=c[4],c)})},function(e){return d[8]=!1,d[9]=c.i64.of_int32(a[3].length),c.i64.gt(d[9],[0,0])?c.loopAsync(d[9],function(e){return d[10]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAtV2"),a[3],d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[12]=d[11].get("device_id"),d[11],d[8]=d[8]||c.i64.eq(d[3],d[12])}])}):c.resolve()},function(a){return c.i64.neq(d[2],f)&&c.i64.neq(d[3],f)&&!d[8]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure]Device Id on client does not match a ent device id, deleting backup client state"),c.sp(b("LSDeleteBackupOnClient"),d[2])):c.resolve()}]):c.resolve(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure]Fetch backup task did not succeed.\n          Not deleting the client state of the device"))},function(a){return c.fe(c.ftr(c.db.table(172).fetch(),function(a){return!0}),function(a){return a["delete"]()})},function(e){return d[0]=c.i64.of_int32(a[1].length),c.i64.eq(d[0],[0,0])?c.db.table(172).add({a:void 0,c:[0,80]}):(d[2]=c.i64.of_int32(a[1].length),c.i64.gt(d[2],[0,0])?c.loopAsync(d[2],function(e){return d[3]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAtV2"),a[1],d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]=d[4].get("backup_id"),d[4],c.db.table(172).add({a:void 0,b:d[5],c:[0,80]})}])}):c.resolve())},function(a){return c.fe(c.ftr(c.db.table(184).fetch(),function(a){return!0}),function(a){return a["delete"]()})},function(e){return d[1]=c.i64.of_int32(a[2].length),c.i64.gt(d[1],[0,0])?c.loopAsync(d[1],function(e){return d[2]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAtV2"),a[2],d[2]).then(function(a){return a=a,d[3]=a[0],a})},function(a){return d[4]=d[3].get("virtual_device_ids"),d[3],d[5]=c.i64.of_int32(d[4].length),c.i64.gt(d[5],[0,0])?c.loopAsync(d[5],function(a){return d[6]=a,c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAtV2"),d[4],d[6]).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[8]=d[7].get("virtual_device_id"),d[7],d[9]=d[3].get("backup_id"),d[3],c.ct(c.ftr(c.db.table(184).fetch(),function(a){return c.i64.eq(a.b,d[9])&&c.blobs.eq(a.c,d[8])})).then(function(a){return d[10]=a})},function(a){return c.i64.eq(d[10],[0,0])?(d[11]=d[3].get("backup_id"),d[3],c.db.table(184).add({a:void 0,b:d[11],c:d[8]})):c.resolve()}])}):c.resolve()}])}):c.resolve()},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSUpdateExtraAttachmentColumns",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.ftr(b.db.table(16).fetch([[[a[0],a[2],a[3]]]]),function(c){return b.i64.eq(c.a,a[0])&&b.i64.eq([0,0],a[1])&&c.c===a[2]&&c.e===a[3]}),function(b){var c=b.update;b.item;return c({bu:a[4],bB:a[5],bI:a[6],cb:a[7],cs:a[8],cc:a[9],bX:a[10],bY:a[11],bZ:a[12],ca:a[13]})})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpdateReadReceipt",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.ftr(b.db.table(14).fetch([[[a[1],{lt:a[0]},a[2]]],"threadKeyReadWatermarkTimestampMs"]),function(c){return b.i64.eq(c.a,a[1])&&b.i64.eq([0,0],[0,0])&&b.i64.eq(c.b,a[2])&&b.i64.lt(c.c,a[0])}),function(c){var d=c.update;c=c.item;return d({c:a[0],k:b.i64.gt(a[3],[0,0])?a[3]:c.k})})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpdateThreadsRangesV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.seq([function(c){return b.fe(b.db.table(10).fetch([[[a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(10).add({a:a[1],b:a[3],c:a[2],e:[0,1],d:[-2147483648,0],f:!1,g:!1,h:b.i64.gt(a[2],[0,1])&&b.i64.gt(a[3],[-2147483648,0]),i:!1})}])},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpsertGradientColor",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(117).put({a:a[0],b:a[1],c:a[2],d:[0,0]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpsertMessage",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(12).fetch([[[a[9]]],"optimistic"]).next().then(function(c,d){var e=c.done;c=c.value;return e?b.db.table(12).add({a:a[3],b:a[5],e:a[8],f:a[9],V:a[2],c:a[6],h:a[10],j:a[12],k:a[14],l:a[15],g:a[0],W:a[1],d:a[7],i:a[11],m:a[16],X:a[17],n:a[18],o:a[19],p:a[20],q:a[21],r:a[22],s:a[23],t:a[24],u:a[25],v:a[26],w:a[27],x:a[28],y:a[29],z:a[30],A:a[32],B:a[33],C:a[34],D:a[35],E:a[36],F:a[37],G:a[38],H:a[39],I:a[40],Z:a[41],J:a[42],K:a[43],L:a[44],M:a[45],N:a[46],O:a[47],P:a[48],Q:a[49],R:a[50],S:a[51],T:a[52],U:a[53],Y:a[54],ba:a[55],bb:a[56]}):(d=c.item,b.i64.le(d.V,a[2])?b.db.table(12).put({a:a[3],b:a[5],e:a[8],f:a[9],V:a[2],c:d.c,h:a[10],j:a[12],k:a[14],l:a[15],g:a[0],W:a[1],d:d.d,i:a[11],m:a[16],X:a[17],n:a[18],o:a[19],p:a[20],q:a[21],r:a[22],s:a[23],t:a[24],u:a[25],v:a[26],w:a[27],x:a[28],y:a[29],z:a[30],A:a[32],B:a[33],C:a[34],D:a[35],E:a[36],F:a[37],G:a[38],H:a[39],I:a[40],Z:a[41],J:a[42],K:a[43],L:a[44],M:a[45],N:a[46],O:a[47],P:a[48],Q:a[49],R:a[50],S:a[51],T:a[52],U:a[53],Y:a[54],ba:a[55],bb:a[56]}):b.resolve())})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpsertSequenceId",["LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[];return c.seq([function(e){return c.seq([function(a){return c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(25).put({a:d[0],b:a[0]})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSUpsertSticker",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(121).put({a:a[0],b:a[1],c:a[2],d:a[3],e:a[4],f:a[5],g:a[6],h:a[7],i:a[8],j:a[9],k:a[10],l:a[11],m:a[12],n:a[13],o:a[14],p:a[15]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpsertStickerPack",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(122).put({a:a[0],b:a[1],c:a[2],d:a[3],e:a[4],f:a[5],g:a[6],h:a[7],i:a[8]})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSUpsertTheme",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(d){return b.i64.neq(e,e)?c[0]=e:c[0]=a[0],b.db.table(116).put({a:a[0],b:a[1],c:a[2],d:a[3],e:a[4],f:a[10]})},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSVerifyPollExists",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return c.db.table(38).fetch([[[a[1]]]]).next().then(function(e,h){var i=e.done;e=e.value;return i?c.seq([function(b){return c.fe(c.ftr(c.db.table(38).fetch([[[a[1]]]]),function(b){return c.i64.eq(b.a,a[1])&&c.i64.lt(b.f,[0,40])}),function(a){return a["delete"]()})},function(b){return c.db.table(38).add({a:a[1],f:[0,40],b:a[0],c:a[2],d:a[3],e:a[4]})},function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[2]=[0,1]:(e=b.item,d[7]=e.bd,c.i64.neq(d[7],f)?d[6]=d[7]:d[6]=[0,1],d[2]=d[6])})},function(e){return d[4]=new c.Map(),d[4].set("thread_key",a[0]),d[4].set("poll_id",a[1]),d[4].set("sync_group",d[2]),d[5]=c.toJSON(d[4]),c.sp(b("LSIssueNewTask"),"poll_point_query",[0,170],d[5],f,f,[0,0],f)},function(a){return d[0]=!1}]):(h=e.item,c.seq([function(b){return c.i64.gt(a[3],h.d)?c.fe(c.db.table(38).fetch([[[a[1]]]]),function(b){var c=b.update;b.item;return c({c:a[2],d:a[3],e:a[4]})}):c.resolve()},function(a){return d[0]=c.i64.eq(h.f,[0,80])}]))})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSWriteThreadCapabilities",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({P:a[1],bb:a[2]})})},function(a){return b.resolve(c)}])}e.exports=a}),null);